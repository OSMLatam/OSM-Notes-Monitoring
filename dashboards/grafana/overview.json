{
  "id": null,
  "uid": "osm-notes-overview-v3",
  "title": "OSM Notes Monitoring - Overview (v3)",
  "tags": ["osm", "monitoring", "overview"],
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "refresh": "30s",
  "editable": true,
  "panels": [
    {
      "id": 1,
      "title": "Component Health Status",
      "type": "table",
      "gridPos": {"h": 10, "w": 8, "x": 0, "y": 0},
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PostgreSQL"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT component, status, last_check, last_success, error_count FROM component_health ORDER BY component",
          "refId": "A"
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [],
        "cellHeight": "sm",
        "footer": {
          "show": false,
          "reducer": ["sum"],
          "countRows": false
        }
      },
      "transformations": [],
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "status"},
            "properties": [
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "type": "value",
                    "options": {
                      "healthy": {"text": "Healthy", "color": "green"},
                      "degraded": {"text": "Degraded", "color": "yellow"},
                      "down": {"text": "Down", "color": "red"},
                      "unknown": {"text": "Unknown", "color": "gray"}
                    }
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    {
      "id": 2,
      "title": "Database Connection Time (Last 24h)",
      "type": "timeseries",
      "gridPos": {"h": 10, "w": 10, "x": 8, "y": 0},
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PostgreSQL"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "SELECT timestamp AS time, metric_value AS value FROM metrics WHERE component = 'ingestion' AND metric_name = 'db_connection_time_ms' AND $__timeFilter(timestamp) ORDER BY timestamp",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "decimals": 0,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"value": null, "color": "green"},
              {"value": 100, "color": "yellow"},
              {"value": 1000, "color": "red"}
            ]
          }
        }
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "yaxes": [
        {"format": "ms", "label": "Time (ms)", "min": 0},
        {"format": "short"}
      ]
    },
    {
      "id": 3,
      "title": "Active Alerts",
      "type": "table",
      "gridPos": {"h": 10, "w": 18, "x": 0, "y": 10},
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PostgreSQL"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT component, alert_level, alert_type, message, created_at FROM alerts WHERE status = 'active' ORDER BY created_at DESC LIMIT 10",
          "refId": "A"
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "created_at",
            "desc": true
          }
        ],
        "cellHeight": "sm"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "alert_level"},
            "properties": [
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "type": "value",
                    "options": {
                      "critical": {"text": "Critical", "color": "red"},
                      "warning": {"text": "Warning", "color": "yellow"},
                      "info": {"text": "Info", "color": "blue"}
                    }
                  }
                ]
              }
            ]
          }
        ]
      }
    }
  ],
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "timepicker": {},
  "templating": {
    "list": []
  },
  "annotations": {
    "list": []
  }
}
