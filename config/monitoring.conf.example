# Monitoring Configuration for OSM-Notes-Monitoring
# Version: 2025-12-31
#
# This file contains monitoring-specific settings.
# Main system properties are in etc/properties.sh
#
# Copy this file to monitoring.conf and configure:
#   cp config/monitoring.conf.example config/monitoring.conf
#
# Database Configuration:
# - DBNAME in etc/properties.sh: Monitoring database (notes_monitoring in prod)
# - INGESTION_DBNAME: Database from OSM-Notes-Ingestion (notes in prod)
# - ANALYTICS_DBNAME: Database from OSM-Notes-Analytics (notes_dwh in prod)
#
# The monitoring system needs:
# 1. Its own database (DBNAME) to store metrics, alerts, security events
# 2. Access to monitored databases (INGESTION_DBNAME, ANALYTICS_DBNAME) to read data

# Component-specific monitoring settings

# Ingestion Monitoring
INGESTION_ENABLED=true
INGESTION_CHECK_TIMEOUT=300  # seconds

# Script Execution Thresholds
INGESTION_SCRIPTS_FOUND_THRESHOLD=3  # minimum number of scripts that should be found
INGESTION_LAST_LOG_AGE_THRESHOLD=24  # hours - alert if no log activity for this long

# Error and Logging Thresholds
INGESTION_MAX_ERROR_RATE=5   # percentage - maximum acceptable error rate
INGESTION_ERROR_COUNT_THRESHOLD=1000  # maximum errors in 24 hours before alert
INGESTION_WARNING_COUNT_THRESHOLD=2000  # maximum warnings in 24 hours before alert
INGESTION_WARNING_RATE_THRESHOLD=15  # percentage - maximum acceptable warning rate
INGESTION_ERROR_SPIKE_MULTIPLIER=2  # multiplier for error spike detection (2x = 10% if max is 5%)

# Database Performance Thresholds
INGESTION_DB_CONNECTION_TIME_THRESHOLD=1000  # milliseconds - alert if connection takes longer
INGESTION_DB_QUERY_TIME_THRESHOLD=1000  # milliseconds - uses PERFORMANCE_SLOW_QUERY_THRESHOLD
INGESTION_DB_CACHE_HIT_THRESHOLD=95  # percentage - minimum acceptable cache hit ratio
INGESTION_DB_CONNECTION_USAGE_THRESHOLD=80  # percentage - alert if connection usage exceeds this

# Performance Check Thresholds
INGESTION_PERFORMANCE_CHECK_DURATION_THRESHOLD=300  # seconds (5 minutes) - alert if check takes longer
INGESTION_PERFORMANCE_CHECK_WARNINGS_THRESHOLD=10  # maximum warnings in performance check

# Data Quality Thresholds
INGESTION_DATA_QUALITY_THRESHOLD=95  # percentage - minimum acceptable data quality score
INGESTION_DATA_QUALITY_CHECK_DURATION_THRESHOLD=600  # seconds (10 minutes) - alert if check takes longer
INGESTION_DATA_FRESHNESS_THRESHOLD=3600  # seconds (1 hour) - alert if data is older than this

# Processing Latency Thresholds
INGESTION_LATENCY_THRESHOLD=300  # seconds (5 minutes) - threshold for processing latency
INGESTION_PROCESSING_FREQUENCY_THRESHOLD=24  # hours - alert if processing frequency exceeds this

# Planet Notes Check Thresholds
INGESTION_PLANET_CHECK_DURATION_THRESHOLD=600  # seconds (10 minutes) - alert if check takes longer

# API Download Thresholds
INGESTION_API_DOWNLOAD_SUCCESS_RATE_THRESHOLD=95  # percentage - minimum acceptable success rate
INGESTION_API_DOWNLOAD_DURATION_THRESHOLD=600  # seconds (10 minutes) - alert if download takes longer
INGESTION_API_SUCCESS_RATE_THRESHOLD=95  # percentage - minimum acceptable API success rate
INGESTION_API_RATE_LIMIT_THRESHOLD=10  # count - alert if rate limit hits exceed this
INGESTION_API_SYNC_GAP_THRESHOLD=3600  # seconds (1 hour) - alert if sync gap exceeds this
INGESTION_API_SUCCESS_RATE_THRESHOLD=95  # percentage - minimum acceptable API success rate
INGESTION_API_RATE_LIMIT_THRESHOLD=10  # count - alert if rate limit hits exceed this
INGESTION_API_SYNC_GAP_THRESHOLD=3600  # seconds (1 hour) - alert if sync gap exceeds this

# Daemon Monitoring Thresholds
INGESTION_DAEMON_CYCLE_DURATION_THRESHOLD=30  # seconds - alert if cycle duration exceeds this
INGESTION_DAEMON_SUCCESS_RATE_THRESHOLD=95  # percentage - minimum acceptable cycle success rate
INGESTION_DAEMON_NO_PROCESSING_THRESHOLD=300  # seconds (5 minutes) - alert if no processing detected

# Analytics Monitoring
ANALYTICS_ENABLED=true
ANALYTICS_CHECK_TIMEOUT=600  # seconds
ANALYTICS_ETL_TIMEOUT=3600   # seconds (1 hour)
ANALYTICS_DATA_FRESHNESS_THRESHOLD=3600  # seconds (1 hour)
ANALYTICS_ETL_SCRIPTS_FOUND_THRESHOLD=2  # minimum number of ETL scripts that should be found
ANALYTICS_ETL_LAST_EXECUTION_AGE_THRESHOLD=3600  # seconds (1 hour) - alert if no ETL execution for this long
ANALYTICS_ETL_DURATION_THRESHOLD=3600  # seconds (1 hour) - alert if a single ETL job runs longer than this
ANALYTICS_ETL_AVG_DURATION_THRESHOLD=1800  # seconds (30 minutes) - alert if average ETL duration exceeds this
ANALYTICS_ETL_MAX_DURATION_THRESHOLD=7200  # seconds (2 hours) - alert if maximum ETL duration exceeds this
ANALYTICS_DATA_MART_UPDATE_AGE_THRESHOLD=3600  # seconds (1 hour) - alert if a data mart hasn't been updated for this long
ANALYTICS_DATA_MART_AVG_UPDATE_AGE_THRESHOLD=1800  # seconds (30 minutes) - alert if average data mart update age exceeds this
ANALYTICS_SLOW_QUERY_THRESHOLD=1000  # milliseconds - alert if query execution time exceeds this
ANALYTICS_AVG_QUERY_TIME_THRESHOLD=500  # milliseconds - alert if average query time exceeds this
ANALYTICS_MAX_QUERY_TIME_THRESHOLD=5000  # milliseconds - alert if maximum query time exceeds this
ANALYTICS_DB_SIZE_THRESHOLD=107374182400  # bytes (100 GB) - alert if database size exceeds this
ANALYTICS_LARGEST_TABLE_SIZE_THRESHOLD=10737418240  # bytes (10 GB) - alert if largest table size exceeds this
ANALYTICS_DISK_USAGE_THRESHOLD=85  # percentage - alert if disk usage exceeds this

# WMS Monitoring
WMS_ENABLED=true
WMS_CHECK_TIMEOUT=30   # seconds
WMS_RESPONSE_TIME_THRESHOLD=2000  # milliseconds
WMS_ERROR_RATE_THRESHOLD=5  # percentage
WMS_HEALTH_CHECK_URL="http://localhost:8080/health"

# API Monitoring
API_ENABLED=true
API_CHECK_TIMEOUT=10   # seconds
API_RESPONSE_TIME_THRESHOLD=500   # milliseconds
API_ERROR_RATE_THRESHOLD=1   # percentage
API_HEALTH_CHECK_URL="http://localhost:8081/health"

# Data Freshness Monitoring
DATA_ENABLED=true
DATA_CHECK_TIMEOUT=60   # seconds
DATA_BACKUP_FRESHNESS_THRESHOLD=86400  # seconds (24 hours)
DATA_REPO_SYNC_CHECK_ENABLED=true

# Infrastructure Monitoring
INFRASTRUCTURE_ENABLED=true
INFRASTRUCTURE_CHECK_TIMEOUT=30   # seconds
INFRASTRUCTURE_CPU_THRESHOLD=80   # percentage
INFRASTRUCTURE_MEMORY_THRESHOLD=85  # percentage
INFRASTRUCTURE_DISK_THRESHOLD=90   # percentage
INFRASTRUCTURE_SWAP_THRESHOLD=50  # percentage - alert if swap usage exceeds this
INFRASTRUCTURE_LOAD_THRESHOLD_MULTIPLIER=2  # multiplier - alert if load average > multiplier x CPU count

# Metrics Collection
METRICS_RETENTION_DAYS=90
METRICS_CLEANUP_ENABLED=true
METRICS_CLEANUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM

# Health Check Settings
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=60  # seconds
HEALTH_CHECK_RETRY_COUNT=3
HEALTH_CHECK_RETRY_DELAY=10  # seconds

# Performance Monitoring
PERFORMANCE_MONITORING_ENABLED=true
PERFORMANCE_SLOW_QUERY_THRESHOLD=1000  # milliseconds
PERFORMANCE_TRACK_DB_QUERIES=true

# Dependency Monitoring
DEPENDENCY_CHECK_ENABLED=true
DEPENDENCY_CHECK_INTERVAL=300  # seconds (5 minutes)

# Notification Settings
NOTIFY_ON_DEGRADED=true
NOTIFY_ON_RECOVERY=true
NOTIFY_ON_MAINTENANCE=false

